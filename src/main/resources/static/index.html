<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã, —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –∏ –¥–æ–ø–∑–∞—Ä–∞–±–æ—Ç–∫–∞</title>
    <style>
        /* ===== –°—Ç–∏–ª–∏ –∫–∞–∫ –≤ —Ç–≤–æ–µ–º –ø—Ä–∏–º–µ—Ä–µ ===== */
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh; padding:10px; color:#333; }
        .container { max-width:1000px; margin:0 auto; background:white;
            border-radius:15px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
        h1 { text-align:center; color:#333; margin-bottom:20px; font-size:clamp(1.8rem,4vw,2.5rem); }

        /* –§–æ—Ä–º—ã –∏ –∫–Ω–æ–ø–∫–∏ */
        .login-form, .add-day-form, .salary-payment-form, .bonus-form {
            background:#f8f9fa; padding:20px; border-radius:10px; margin-bottom:20px; }
        label { display:block; margin-bottom:5px; font-weight:600; }
        input, select, textarea { width:100%; padding:10px; border-radius:8px; border:2px solid #e1e5e9; }
        .btn { display:inline-block; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; }
        .btn-success { background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%); }
        .btn-warning { background:linear-gradient(135deg,#ffd93d 0%,#ff9a3d 100%); }
        .btn-danger { background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%); }
        .btn-info { background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%); }

        .message { padding:12px; border-radius:8px; margin-bottom:15px; text-align:center; font-weight:500; display:none; }
        .message.success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; display:block; }
        .message.error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; display:block; }

        /* –¢–∞–±—ã */
        .tabs { display:flex; margin-bottom:15px; border-bottom:2px solid #e1e5e9; overflow-x:auto; }
        .tab { padding:12px 16px; cursor:pointer; border-bottom:3px solid transparent; white-space:nowrap; }
        .tab.active { border-bottom-color:#667eea; color:#667eea; font-weight:600; }
        .tab-content { display:none; }
        .tab-content.active { display:block; }

        /* –°–≤–æ–¥–∫–∞ */
        .summary-card { background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%); color:white; padding:20px; border-radius:10px; margin-bottom:20px; text-align:center; }
        .summary-numbers { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
        .summary-item { padding:10px; }
        .summary-value { font-size:clamp(1.5rem,4vw,2rem); font-weight:bold; margin-bottom:5px; }
        .summary-label { font-size:clamp(0.8rem,2.5vw,0.9rem); opacity:0.9; }

        /* –°–ø–∏—Å–∫–∏ */
        .workdays-container, .payments-container { margin-top:15px; }
        .workday-card, .payment-card { background:#f8f9fa; border-radius:8px; padding:15px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
        .workday-salary, .payment-amount { color:white; padding:4px 8px; border-radius:15px; font-weight:bold; white-space:nowrap; }
        .workday-salary { background:#4CAF50; }
        .payment-amount { background:#667eea; }

        .loading { text-align:center; padding:20px; color:#666; }
        .empty-state { text-align:center; padding:30px; color:#666; }
        .empty-state div:first-child { font-size:clamp(2rem,8vw,3rem); margin-bottom:15px; opacity:0.5; }
        .month-group { margin-bottom:25px; border:1px solid #e1e5e9; border-radius:10px; overflow:hidden; background:white; }
        .month-header { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:15px 20px; font-weight:600; display:flex; justify-content:space-between; align-items:center; }
        .month-total { background:rgba(255,255,255,0.2); padding:5px 10px; border-radius:15px; font-size:0.9rem; }
        .month-days .workday-card { margin-bottom:0; border-radius:0; border-left:none; border-bottom:1px solid #e1e5e9; }
        .month-days .workday-card:last-child { border-bottom:none; }

    </style>
</head>
<body>
<div class="container">
    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <div id="loginForm" class="login-form">
        <h3>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h3>
        <form id="loginFormElement">
            <div class="form-group">
                <label for="username">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</label>
                <select id="username" name="username" required class="form-control">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è --</option>
                    <option value="–ú–∏—à–∞">üë§ –ú–∏—à–∞</option>
                    <option value="–ò–≥–æ—Ä—å">üë§ –ò–≥–æ—Ä—å</option>
                </select>
            </div>
            <div class="form-group">
                <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="password" name="password" required placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button type="submit" class="btn btn-success">–í–æ–π—Ç–∏</button>
        </form>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="mainContent" style="display:none;">
        <div class="user-info">
            <span>üë§ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <span id="currentUserName"></span></span>
            <button onclick="logout()" class="btn btn-danger">üö™ –í—ã–π—Ç–∏</button>
        </div>

        <h1>üí∞ –£—á–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã, —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –∏ –¥–æ–ø–∑–∞—Ä–∞–±–æ—Ç–∫–∞</h1>

        <!-- –°–≤–æ–¥–∫–∞ -->
        <div class="summary-card">
            <h2>üìä –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞</h2>
            <div class="summary-numbers">
                <div class="summary-item">
                    <div class="summary-value" id="totalDays">0</div>
                    <div class="summary-label">–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–Ω–µ–π</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="totalEarned">0 ‚ÇΩ</div>
                    <div class="summary-label">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="totalPaid">0 ‚ÇΩ</div>
                    <div class="summary-label">–ü–æ–ª—É—á–µ–Ω–æ –≤—ã–ø–ª–∞—Ç</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="salaryBalance">0 ‚ÇΩ</div>
                    <div class="summary-label">–û—Å—Ç–∞—Ç–æ–∫ (–¥–æ–ª–≥)</div>
                </div>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div id="message" class="message"></div>

        <!-- –¢–∞–±—ã -->
        <div class="tabs">
            <div class="tab active" data-tab="workdays">üìÖ –†–∞–±–æ—á–∏–µ –¥–Ω–∏</div>
            <div class="tab" data-tab="payments">üíµ –í—ã–ø–ª–∞—Ç—ã</div>
            <div class="tab" data-tab="bonuses">üíé –î–æ–ø–∑–∞—Ä–∞–±–æ—Ç–æ–∫</div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–æ–≤ -->
        <div class="tab-content active" id="workdaysTab">
            <div class="add-day-form">
                <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</h3>
                <form id="workdayForm">
                    <div class="form-group">
                        <label for="workdayDate">–î–∞—Ç–∞:</label>
                        <input type="date" id="workdayDate" name="workdayDate" required>
                    </div>
                    <div class="form-group">
                        <label for="workdaySalary">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ (—Ä—É–±):</label>
                        <input type="number" id="workdaySalary" name="workdaySalary" min="0" step="100" required>
                    </div>
                    <div class="form-group">
                        <label for="workdayDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <input type="text" id="workdayDescription" name="workdayDescription" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, —Å–º–µ–Ω–∞, –ø—Ä–æ–µ–∫—Ç">
                    </div>
                    <button type="submit" class="btn btn-success">üíæ –î–æ–±–∞–≤–∏—Ç—å –¥–µ–Ω—å</button>
                </form>
            </div>
            <div class="workdays-container" id="workdaysContainer">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>

        <div class="tab-content" id="paymentsTab">
            <div class="salary-payment-form">
                <h3>üí∏ –î–æ–±–∞–≤–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É</h3>
                <form id="paymentForm">
                    <div class="form-group">
                        <label for="paymentDate">–î–∞—Ç–∞ –≤—ã–ø–ª–∞—Ç—ã:</label>
                        <input type="date" id="paymentDate" name="paymentDate" required>
                    </div>
                    <div class="form-group">
                        <label for="paymentAmount">–°—É–º–º–∞ (—Ä—É–±):</label>
                        <input type="number" id="paymentAmount" name="paymentAmount" min="0" step="100" required>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ –î–æ–±–∞–≤–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É</button>
                </form>
            </div>
            <div class="payments-container" id="paymentsContainer">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>

        <div class="tab-content" id="bonusesTab">
            <div class="bonus-form">
                <h3>‚ú® –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–∑–∞—Ä–∞–±–æ—Ç–æ–∫</h3>
                <form id="bonusForm">
                    <div class="form-group">
                        <label for="bonusDate">–î–∞—Ç–∞:</label>
                        <input type="date" id="bonusDate" name="bonusDate" required>
                    </div>
                    <div class="form-group">
                        <label for="bonusDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <input type="text" id="bonusDescription" name="bonusDescription" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ–º–∏—è">
                    </div>
                    <div class="form-group">
                        <label for="bonusAmount">–°—É–º–º–∞ (—Ä—É–±):</label>
                        <input type="number" id="bonusAmount" name="bonusAmount" min="0" step="100" required>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ –î–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å</button>
                </form>
            </div>
            <div class="bonuses-list">
                <button id="loadBonuses" class="btn btn-info">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –±–æ–Ω—É—Å—ã</button>
                <div id="bonusesContainer" class="workdays-container">
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    const API_BASE_URL = 'http://localhost:8080/api'; // —Å—é–¥–∞ —Ç–≤–æ–π –±—ç–∫–µ–Ω–¥

    let currentUser = null;

    // ======= –í—Ö–æ–¥/–í—ã—Ö–æ–¥ =======
    document.getElementById('loginFormElement').addEventListener('submit', (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        if (!username) return showMessage('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
        currentUser = { userId: username, name: username };
        document.getElementById('currentUserName').textContent = username;
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        loadAllData();
    });

    function logout() {
        if (!confirm('–í—ã–π—Ç–∏?')) return;
        currentUser = null;
        document.getElementById('mainContent').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
    }

    // ======= –¢–∞–±—ã =======
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tab.dataset.tab + 'Tab').classList.add('active');
        });
    });

    // ======= –°–æ–æ–±—â–µ–Ω–∏—è =======
    function showMessage(msg, type='success') {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = msg;
        messageDiv.className = `message ${type}`;
        setTimeout(()=>{ messageDiv.style.display='none'; }, 3000);
    }

    // ======= –§–æ—Ä–º–∞—Ç—ã =======
    function formatMoney(value) { return value.toLocaleString('ru-RU') + ' ‚ÇΩ'; }
    function formatDate(dateStr) { const d=new Date(dateStr); return d.toLocaleDateString('ru-RU'); }
    function safeNumber(v) { return isNaN(v)?0:v; }

    // ======= –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö =======
    async function loadAllData() {
        await Promise.all([loadWorkdays(), loadPayments(), loadBonuses()]);
        updateSummary();
    }

    // ======= –†–∞–±–æ—Ç–∞ —Å —Ä–∞–±–æ—á–∏–º–∏ –¥–Ω—è–º–∏ =======
    const workdayForm = document.getElementById('workdayForm');
    const workdaysContainer = document.getElementById('workdaysContainer');
    workdayForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            date: document.getElementById('workdayDate').value,
            description: document.getElementById('workdayDescription').value,
            amount: parseFloat(document.getElementById('workdaySalary').value)
        };
        await addWorkday(data);
    });

    async function loadWorkdays() {
        if (!currentUser) return;
        workdaysContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
        try {
            const res = await fetch(`${API_BASE_URL}/workdays?userId=${currentUser.userId}`);
            const workdays = res.ok ? await res.json() : [];
            if (!workdays.length) { workdaysContainer.innerHTML='<div class="empty-state"><div>üìÖ</div>–ù–µ—Ç —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</div>'; return; }
            const grouped = groupByMonth(workdays);
            workdaysContainer.innerHTML = Object.keys(grouped).map(month=>{
                const monthDays = grouped[month].map(wd=>`
                <div class="workday-card">
                    <div>
                        <div>üìÖ ${formatDate(wd.date)} <span class="workday-salary">${formatMoney(wd.amount)}</span></div>
                        <div>${wd.description||''}</div>
                    </div>
                    <button class="btn btn-danger" onclick="deleteWorkday(${wd.id})">üóëÔ∏è</button>
                </div>
            `).join('');
                const totalMonth = grouped[month].reduce((s,w)=>s+w.amount,0);
                return `<div class="month-group">
                <div class="month-header">${month} <span class="month-total">–í—Å–µ–≥–æ: ${formatMoney(totalMonth)}</span></div>
                <div class="month-days">${monthDays}</div>
            </div>`;
            }).join('');
        } catch(e){ workdaysContainer.innerHTML='<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>'; }
    }

    async function addWorkday(data) {
        if (!currentUser) return;
        try {
            const res = await fetch(`${API_BASE_URL}/workdays?userId=${currentUser.userId}`,{
                method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)
            });
            if (res.ok) { showMessage('–î–µ–Ω—å –¥–æ–±–∞–≤–ª–µ–Ω'); workdayForm.reset(); loadWorkdays(); updateSummary(); }
        } catch(e){ showMessage('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', 'error'); }
    }

    async function deleteWorkday(id) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å –¥–µ–Ω—å?')) return;
        try {
            const res = await fetch(`${API_BASE_URL}/workdays/${id}?userId=${currentUser.userId}`,{method:'DELETE'});
            if (res.ok) { showMessage('–î–µ–Ω—å —É–¥–∞–ª–µ–Ω'); loadWorkdays(); updateSummary(); }
        } catch(e){ showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error'); }
    }

    // ======= –í—ã–ø–ª–∞—Ç—ã =======
    const paymentForm = document.getElementById('paymentForm');
    const paymentsContainer = document.getElementById('paymentsContainer');
    paymentForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            date: document.getElementById('paymentDate').value,
            amount: parseFloat(document.getElementById('paymentAmount').value)
        };
        await addPayment(data);
    });

    async function loadPayments() {
        if (!currentUser) return;
        paymentsContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
        try {
            const res = await fetch(`${API_BASE_URL}/payments?userId=${currentUser.userId}`);
            const payments = res.ok ? await res.json() : [];
            if (!payments.length) { paymentsContainer.innerHTML='<div class="empty-state"><div>üíµ</div>–ù–µ—Ç –≤—ã–ø–ª–∞—Ç</div>'; return; }
            payments.sort((a,b)=>new Date(b.date)-new Date(a.date));
            paymentsContainer.innerHTML = payments.map(p=>`
            <div class="payment-card">
                <div>üìÖ ${formatDate(p.date)}</div>
                <div class="payment-amount">${formatMoney(p.amount)}</div>
                <button class="btn btn-danger" onclick="deletePayment(${p.id})">üóëÔ∏è</button>
            </div>
        `).join('');
        } catch(e){ paymentsContainer.innerHTML='<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>'; }
    }

    async function addPayment(data) {
        if (!currentUser) return;
        try {
            const res = await fetch(`${API_BASE_URL}/payments?userId=${currentUser.userId}`,{
                method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)
            });
            if (res.ok) { showMessage('–í—ã–ø–ª–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞'); paymentForm.reset(); loadPayments(); updateSummary(); }
        } catch(e){ showMessage('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', 'error'); }
    }

    async function deletePayment(id) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É?')) return;
        try {
            const res = await fetch(`${API_BASE_URL}/payments/${id}?userId=${currentUser.userId}`,{method:'DELETE'});
            if (res.ok) { showMessage('–í—ã–ø–ª–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∞'); loadPayments(); updateSummary(); }
        } catch(e){ showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error'); }
    }

    // ======= –î–æ–ø–∑–∞—Ä–∞–±–æ—Ç–∫–∏ =======
    const bonusForm = document.getElementById('bonusForm');
    const bonusesContainer = document.getElementById('bonusesContainer');
    bonusForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const data = {
            date: document.getElementById('bonusDate').value,
            description: document.getElementById('bonusDescription').value,
            amount: parseFloat(document.getElementById('bonusAmount').value)
        };
        await addBonus(data);
    });

    document.getElementById('loadBonuses').addEventListener('click', loadBonuses);

    async function loadBonuses() {
        if (!currentUser) return;
        bonusesContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
        try {
            const res = await fetch(`${API_BASE_URL}/bonuses?userId=${currentUser.userId}`);
            const bonuses = res.ok ? await res.json() : [];
            if (!bonuses.length) { bonusesContainer.innerHTML='<div class="empty-state"><div>üíé</div>–ù–µ—Ç –±–æ–Ω—É—Å–æ–≤</div>'; return; }
            bonuses.sort((a,b)=>new Date(b.date)-new Date(a.date));
            bonusesContainer.innerHTML = bonuses.map(b=>`
            <div class="workday-card">
                <div>
                    <div>üìÖ ${formatDate(b.date)} <span class="workday-salary">${formatMoney(b.amount)}</span></div>
                    <div>${b.description||'–î–æ–ø–∑–∞—Ä–∞–±–æ—Ç–æ–∫'}</div>
                </div>
                <button class="btn btn-danger" onclick="deleteBonus(${b.id})">üóëÔ∏è</button>
            </div>
        `).join('');
        } catch(e){ bonusesContainer.innerHTML='<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>'; }
    }

    async function addBonus(data) {
        if (!currentUser) return;
        try {
            const res = await fetch(`${API_BASE_URL}/bonuses?userId=${currentUser.userId}`,{
                method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)
            });
            if (res.ok) { showMessage('–ë–æ–Ω—É—Å –¥–æ–±–∞–≤–ª–µ–Ω'); bonusForm.reset(); loadBonuses(); updateSummary(); }
        } catch(e){ showMessage('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', 'error'); }
    }

    async function deleteBonus(id) {
        if (!confirm('–£–¥–∞–ª–∏—Ç—å –±–æ–Ω—É—Å?')) return;
        try {
            const res = await fetch(`${API_BASE_URL}/bonuses/${id}?userId=${currentUser.userId}`,{method:'DELETE'});
            if (res.ok) { showMessage('–ë–æ–Ω—É—Å —É–¥–∞–ª–µ–Ω'); loadBonuses(); updateSummary(); }
        } catch(e){ showMessage('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error'); }
    }

    // ======= –°–≤–æ–¥–∫–∞ =======
    async function updateSummary() {
        if (!currentUser) return;
        try {
            const [workRes, payRes, bonusRes] = await Promise.all([
                fetch(`${API_BASE_URL}/workdays/statistics?userId=${currentUser.userId}`),
                fetch(`${API_BASE_URL}/payments/statistics?userId=${currentUser.userId}`),
                fetch(`${API_BASE_URL}/bonuses/statistics?userId=${currentUser.userId}`)
            ]);
            const workStats = workRes.ok ? await workRes.json() : {totalDays:0,totalEarned:0,salaryBalance:0};
            const payStats = payRes.ok ? await payRes.json() : {totalPaid:0};
            const bonusStats = bonusRes.ok ? await bonusRes.json() : {totalBonus:0};

            document.getElementById('totalDays').textContent = safeNumber(workStats.totalDays);
            document.getElementById('totalEarned').textContent = formatMoney(safeNumber(workStats.totalEarned)+safeNumber(bonusStats.totalBonus));
            document.getElementById('totalPaid').textContent = formatMoney(safeNumber(payStats.totalPaid));
            const balance = safeNumber(workStats.salaryBalance);
            const balanceSpan = document.getElementById('salaryBalance');
            balanceSpan.textContent = formatMoney(balance);
            balanceSpan.style.color = balance>0?'green':balance<0?'red':'#333';
        } catch(e){ console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤–æ–¥–∫–∏', e); }
    }

    // ======= –£—Ç–∏–ª–∏—Ç—ã =======
    function groupByMonth(arr){
        const map={};
        arr.forEach(item=>{
            const d=new Date(item.date);
            const monthName = d.toLocaleString('ru-RU',{month:'long',year:'numeric'});
            if(!map[monthName]) map[monthName]=[];
            map[monthName].push(item);
        });
        return map;
    }

    // ======= –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—ã =======
    document.getElementById('workdayDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('bonusDate').value = new Date().toISOString().split('T')[0];
</script>
</body>
</html>
